<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>2048</title>
  <style>
    body { font-family: "Helvetica Neue", Arial, sans-serif; margin: 0; padding: 0; background: #faf8ef; color: #776e65; }
    .container { width: 300px; margin: 50px auto; text-align: center; }
    .game-container { position: relative; padding: 10px; cursor: default; background: #bbada0; border-radius: 6px; width: 300px; height: 300px; box-sizing: border-box; }
    .grid-cell { width: 65px; height: 65px; margin-bottom: 10px; margin-right: 10px; float: left; border-radius: 3px; background: rgba(238, 228, 218, 0.35); }
    .grid-cell:nth-child(4n) { margin-right: 0; }
    .tile { position: absolute; width: 65px; height: 65px; border-radius: 3px; text-align: center; font-weight: bold; z-index: 10; font-size: 35px; line-height: 65px; transition: 100ms ease-in-out; }
    .tile-2 { background: #eee4da; color: #776e65; }
    .tile-4 { background: #ede0c8; color: #776e65; }
    .tile-8 { background: #f2b179; color: #f9f6f2; }
    .tile-16 { background: #f59563; color: #f9f6f2; }
    .tile-32 { background: #f67c5f; color: #f9f6f2; }
    .tile-64 { background: #f65e3b; color: #f9f6f2; }
    .tile-128 { background: #edcf72; color: #f9f6f2; font-size: 30px; }
    .tile-256 { background: #edcc61; color: #f9f6f2; font-size: 30px; }
    .score-container { background: #bbada0; padding: 10px; color: white; border-radius: 3px; margin-bottom: 10px; font-weight: bold; }
    button { background: #8f7a66; color: white; border: none; padding: 10px 20px; border-radius: 3px; cursor: pointer; font-size: 16px; margin-top: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="score-container">分数: <span id="score">0</span></div>
    <div class="game-container" id="game-board">
      <!-- Grid -->
      <div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div>
      <div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div>
      <div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div>
      <div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div>
    </div>
    <p>使用方向键移动</p>
    <button onclick="initGame()">重新开始</button>
  </div>

  <script>
    var board = [];
    var score = 0;
    var rows = 4;
    var cols = 4;

    document.addEventListener('keydown', handleInput);
    initGame();

    function initGame() {
        board = Array(rows).fill().map(() => Array(cols).fill(0));
        score = 0;
        document.getElementById('score').innerText = score;
        document.querySelectorAll('.tile').forEach(t => t.remove());
        addRandomTile();
        addRandomTile();
        updateBoard();
    }

    function addRandomTile() {
        let empty = [];
        for(let r=0; r<rows; r++) 
            for(let c=0; c<cols; c++) 
                if(board[r][c] == 0) empty.push({r,c});
        if(empty.length > 0) {
            let {r, c} = empty[Math.floor(Math.random() * empty.length)];
            board[r][c] = Math.random() < 0.9 ? 2 : 4;
        }
    }

    function updateBoard() {
        document.querySelectorAll('.tile').forEach(t => t.remove());
        const container = document.getElementById('game-board');
        for(let r=0; r<rows; r++) {
            for(let c=0; c<cols; c++) {
                if(board[r][c] > 0) {
                    let tile = document.createElement('div');
                    tile.className = `tile tile-${board[r][c]}`;
                    tile.innerText = board[r][c];
                    // Calculate position
                    tile.style.top = (10 + r * 75) + 'px';
                    tile.style.left = (10 + c * 75) + 'px';
                    container.appendChild(tile);
                }
            }
        }
    }

    function handleInput(e) {
        let moved = false;
        if(e.key === 'ArrowUp') moved = moveUp();
        else if(e.key === 'ArrowDown') moved = moveDown();
        else if(e.key === 'ArrowLeft') moved = moveLeft();
        else if(e.key === 'ArrowRight') moved = moveRight();

        if(moved) {
            addRandomTile();
            updateBoard();
            document.getElementById('score').innerText = score;
        }
    }

    // Simplified move logic for brevity (combining omitted, just sliding)
    function moveLeft() {
        let moved = false;
        for(let r=0; r<rows; r++) {
            let row = board[r].filter(x => x!=0);
            for(let i=0; i<row.length-1; i++) {
                if(row[i] == row[i+1]) {
                    row[i] *= 2; score += row[i];
                    row.splice(i+1, 1);
                    moved = true;
                }
            }
            while(row.length < cols) row.push(0);
            if(board[r].join(',') != row.join(',')) moved = true;
            board[r] = row;
        }
        return moved;
    }
    
    // Rotate board to reuse moveLeft logic for other directions
    function rotateBoard() {
        let newBoard = Array(rows).fill().map(() => Array(cols).fill(0));
        for(let r=0; r<rows; r++)
            for(let c=0; c<cols; c++)
                newBoard[c][rows-1-r] = board[r][c];
        board = newBoard;
    }

    function moveDown() { rotateBoard(); rotateBoard(); rotateBoard(); let m = moveLeft(); rotateBoard(); return m; }
    function moveRight() { rotateBoard(); rotateBoard(); let m = moveLeft(); rotateBoard(); rotateBoard(); return m; }
    function moveUp() { rotateBoard(); let m = moveLeft(); rotateBoard(); rotateBoard(); rotateBoard(); return m; }

  </script>
</body>
</html>

